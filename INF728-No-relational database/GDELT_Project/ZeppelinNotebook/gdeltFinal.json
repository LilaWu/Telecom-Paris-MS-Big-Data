{"paragraphs":[{"text":"import org.apache.spark.{SparkConf, SparkContext}\nimport org.apache.spark.sql.{DataFrame, SparkSession, SaveMode}\nimport org.apache.spark.input.PortableDataStream\nimport org.apache.spark.sql.functions._\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\nimport com.datastax.spark.connector.cql.CassandraConnector\nimport org.apache.spark.sql.cassandra._\n\nimport org.apache.spark.rdd.RDD\n\nimport spark.implicits._\nval AWS_ID = \"TODO\"\nval AWS_KEY = \"TODO\"\nval AWS_TOKEN = \"TODO\"\nval s3_name = \"TODO\"\n\nsc.hadoopConfiguration.set(\"fs.s3a.aws.credentials.provider\", \"org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider\")\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID)\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY)\nsc.hadoopConfiguration.set(\"fs.s3a.session.token\", AWS_TOKEN)","user":"anonymous","dateUpdated":"2020-01-23T10:58:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.{SparkConf, SparkContext}\nimport org.apache.spark.sql.{DataFrame, SparkSession, SaveMode}\nimport org.apache.spark.input.PortableDataStream\nimport org.apache.spark.sql.functions._\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\nimport com.datastax.spark.connector.cql.CassandraConnector\nimport org.apache.spark.sql.cassandra._\nimport org.apache.spark.rdd.RDD\nimport spark.implicits._\nAWS_ID: String = ASIATATIKUDEA67DTRWE\nAWS_KEY: String = kRkLC0Rr2AUs/S314t6HEzidkhKR+rN9PCPmqccq\nAWS_TOKEN: String = FwoGZXIvYXdzELn//////////wEaDFtf7YtlG3Cy2KwGWyLMAcZtWzjtdjg4960EYUH72W2shSuqq6kLT6UjLGy6MQunS3xG8vstU1yGJL9ud9WVDSvalcerZDWDpuhqWJJAAOjngPNn7QIbErcfbGPPglBCSjEyprnSqeLHXfymw0MnT/O0NuvUv4HYPq3ylC664JiTBTnNE4Ike+nCd06lFavqdm..."}]},"apps":[],"jobName":"paragraph_1579769657125_841030497","id":"20200123-085417_320799483","dateCreated":"2020-01-23T08:54:17+0000","dateStarted":"2020-01-23T09:30:36+0000","dateFinished":"2020-01-23T09:30:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:172"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579774314543_-505971737","id":"20200123-101154_1340086794","dateCreated":"2020-01-23T10:11:54+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:865","text":"// ********************* QUERY 1 *********************","dateUpdated":"2020-01-23T10:12:02+0000"},{"text":"// Load from parquet in dataframe\nval eventByDayDF = spark.read.load(\"s3://\" + s3_name + \"/event_by_day.parquet/*\")","user":"anonymous","dateUpdated":"2020-01-23T10:34:40+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579769727105_181455040","id":"20200123-085527_1390306750","dateCreated":"2020-01-23T08:55:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:173","dateFinished":"2020-01-23T10:34:44+0000","dateStarted":"2020-01-23T10:34:40+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"eventByDayDF: org.apache.spark.sql.DataFrame = [date: string, country: string ... 2 more fields]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579772392671_2012605681","id":"20200123-093952_2061026873","dateCreated":"2020-01-23T09:39:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:526","text":"// Input in Cassandra\nCassandraConnector(sc.getConf).withSessionDo { session =>\n      session.execute(\n        \"\"\"\n           CREATE KEYSPACE IF NOT EXISTS gdelt\n           WITH REPLICATION =\n           {'class': 'SimpleStrategy', 'replication_factor': 2 };\n        \"\"\")\n        session.execute(\n        \"\"\"\n           CREATE TABLE IF NOT EXISTS gdelt.event_by_day (\n              date text,\n              country text,\n              language text,\n              count_events int,\n              PRIMARY KEY (date, country, language)\n            );\n        \"\"\"\n      )\n}\n\ndfReordered.write\n      .cassandraFormat(\"event_by_day\", \"gdelt\")\n      .save()","dateUpdated":"2020-01-23T10:35:47+0000","dateFinished":"2020-01-23T10:04:53+0000","dateStarted":"2020-01-23T09:53:13+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"// Load and postprocess from Cassandra","user":"anonymous","dateUpdated":"2020-01-23T10:12:57+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579774366168_1393714176","id":"20200123-101246_615350190","dateCreated":"2020-01-23T10:12:46+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1009"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579772823371_-1804708470","id":"20200123-094703_329133696","dateCreated":"2020-01-23T09:47:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:651","text":"val query1 = spark.read\n      .cassandraFormat(\"event_by_day\", \"gdelt\")\n      .load()\nquery1.show(5)","dateUpdated":"2020-01-23T10:13:20+0000","dateFinished":"2020-01-23T10:13:35+0000","dateStarted":"2020-01-23T10:13:20+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+-------+--------+------------+\n|    date|country|language|count_events|\n+--------+-------+--------+------------+\n|20190128|       |     afr|           4|\n|20190128|       |     ara|         237|\n|20190128|       |     axe|          22|\n|20190128|       |     ben|         112|\n|20190128|       |     bos|          31|\n+--------+-------+--------+------------+\nonly showing top 5 rows\n\nquery1: org.apache.spark.sql.DataFrame = [date: string, country: string ... 2 more fields]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579775751510_693751442","id":"20200123-103551_339447078","dateCreated":"2020-01-23T10:35:51+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7602","text":"// Display results","dateUpdated":"2020-01-23T10:35:59+0000"},{"text":"// Display number of events by country\nz.show(query1.select(\"country\",\"count_events\").groupBy(\"country\").agg(sum(\"count_events\")))","user":"anonymous","dateUpdated":"2020-01-23T10:36:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"pieChart","height":759.967,"optionOpen":true,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country":"string","sum(count_events)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"pieChart":{}},"commonSetting":{},"keys":[{"name":"country","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"sum(count_events)","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579769746943_-1264500175","id":"20200123-085546_800023469","dateCreated":"2020-01-23T08:55:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:174","dateFinished":"2020-01-23T10:34:36+0000","dateStarted":"2020-01-23T10:34:16+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"country\tsum(count_events)\nLT\t1166\nCI\t13434\nPC\t6\nFI\t14398\nIC\t2515\nPM\t27781\nSC\t168\nPU\t364\nNS\t712\nRO\t49127\nSL\t2227\nLA\t2298\nNL\t35892\nSB\t1\nMN\t1379\nAM\t17093\nPL\t62888\nPS\t567\nRE\t509\nUV\t12966\nMK\t37718\nAA\t118\nAY\t936\nDR\t2118\nMX\t185394\nPF\t232\nYI\t218\nGL\t916\nTV\t68\nBP\t534\nSM\t84\nCN\t248\nFG\t96\nTI\t1675\nSW\t39707\nAV\t360\nBU\t17369\nCG\t13737\nNT\t3\nHR\t12662\nLI\t2895\nSV\t77\nBX\t2142\nNP\t11829\nWE\t38402\nTU\t158318\nSO\t20580\nVQ\t465\nGG\t6110\nRI\t15561\nRQ\t9159\nPG\t95\nBC\t1406\nGH\t27975\nBN\t1569\nCV\t301\nHK\t7264\nNH\t1353\nMI\t4330\nTW\t15495\nGV\t2216\nSU\t30945\nBD\t1506\nTO\t2567\nWI\t239\nFK\t7\nID\t64135\nLY\t17475\nIV\t6469\nTP\t69\nAU\t15061\nGZ\t6625\nPK\t102408\nSA\t94956\nBL\t12003\nBM\t8079\nCA\t302318\nCT\t3756\nNE\t276\nUZ\t3152\nGB\t6632\nMT\t10352\nBR\t115969\nKZ\t8348\nBY\t2149\nHO\t12582\nNC\t184\nVT\t2958\nEN\t3837\nGK\t879\nGT\t12430\nMD\t5078\nIO\t31\nRB\t12835\nGJ\t846\nSP\t82467\nBH\t1748\nEC\t6704\nES\t6869\nIR\t132758\nMO\t13403\nNR\t283\nVI\t165\nPO\t18651\nMR\t2083\nVE\t179705\nMB\t348\nOD\t3279\nZA\t4455\nJN\t1\nSF\t54206\nKR\t114\nWQ\t3\nTZ\t4247\nWA\t3258\nAQ\t307\nRS\t392853\nUS\t3619226\nLH\t8966\nTS\t8576\nEK\t828\nAL\t10857\nMY\t22783\nIN\t234283\nJM\t9451\nGM\t138054\nBK\t1621\nAE\t30224\nKV\t5018\nCM\t4953\nMJ\t1186\nRW\t5185\nFR\t179814\nAJ\t13562\nDA\t18977\nCH\t321752\nMG\t1771\nTN\t878\nGQ\t1613\nNU\t7386\nKT\t47\nTL\t22\nZI\t39862\nGR\t78114\nUP\t68984\nGI\t1258\nPA\t2972\nTD\t3113\nRP\t56899\nAG\t6054\nDJ\t2710\nMC\t615\nHA\t5507\nBA\t6475\nJO\t26209\nET\t9873\nSG\t3950\nEI\t97612\nBF\t8919\nCU\t19758\nIT\t132096\nFO\t48\nMV\t2156\nSE\t654\nVM\t31625\nBG\t38572\nFJ\t6431\nWS\t1815\nKU\t14742\nUK\t531557\nCJ\t887\nCW\t138\nFM\t411\nLO\t3622\nMH\t366\nMU\t8735\nOS\t3936\nPE\t23993\nLS\t198\nHQ\t5\nMZ\t4804\nLG\t5280\nDO\t779\nLE\t29455\nQA\t28547\nTH\t50020\nEG\t89966\nSH\t10\nCS\t4034\nMF\t85\nGY\t2868\nFP\t187\nCE\t12973\nVC\t526\nRN\t71\nSN\t29716\nTX\t2848\nCB\t6691\nNZ\t27197\nBT\t1254\nHU\t13774\nKN\t78180\nYM\t29595\nKE\t53130\nCY\t8718\nSI\t3103\nML\t13328\nEZ\t10732\nGP\t866\nUG\t9101\nGA\t2983\nAS\t172467\nBE\t66496\nMA\t1593\nWZ\t554\nAC\t1037\nAN\t507\nKS\t60333\nNI\t105289\nKG\t3590\n\t598531\nTT\t466\nBO\t8976\nNO\t20257\nSY\t186807\nER\t1873\nJQ\t2\nCO\t38621\nIM\t113\nIZ\t63293\nUY\t4105\nOC\t431\nNG\t8995\nJE\t8303\nAR\t24879\nCF\t29712\nRM\t386\nTK\t158\nLU\t3780\nSZ\t59884\nNF\t4\nIS\t375258\nMP\t5583\nAF\t103784\nJA\t90386\nBB\t1222\nCQ\t88\nPP\t1529\nCD\t14283\nAO\t3866\nST\t564\n"},{"type":"TEXT","data":""}]}},{"text":"// Display number of events by day\nz.show(query1.select(\"date\",\"count_events\").groupBy(\"date\").agg(sum(\"count_events\").alias(\"number of events\")).filter($\"date\".startsWith(\"2019\")))","user":"anonymous","dateUpdated":"2020-01-23T10:46:08+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"date":"string","number of events":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"date","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"number of events","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579769799774_-114338410","id":"20200123-085639_223947056","dateCreated":"2020-01-23T08:56:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:175","dateFinished":"2020-01-23T10:45:59+0000","dateStarted":"2020-01-23T10:45:56+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"date\tnumber of events\n20190112\t305185\n20190111\t369702\n20190113\t222938\n20190126\t267766\n20190121\t385453\n20190123\t351807\n20190109\t469150\n20190115\t429076\n20190130\t376774\n20190108\t331061\n20190102\t307172\n20190106\t246195\n20190119\t251882\n20190128\t348697\n20190118\t425153\n20190107\t347769\n20190125\t357498\n20190104\t266620\n20190122\t375492\n20190127\t276256\n20190101\t212845\n20190131\t427761\n20190110\t478904\n20190120\t239146\n20190105\t252443\n20190114\t383638\n20190129\t509482\n20190103\t391436\n20190124\t430165\n20190117\t410412\n20190116\t537549\n"},{"type":"TEXT","data":""}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579775814109_2024235678","id":"20200123-103654_1317580592","dateCreated":"2020-01-23T10:36:54+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7680"}],"name":"gdeltFinal","id":"2EYBY259P","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}